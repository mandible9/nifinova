<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}NIFINOVA - Advanced AI Trading Platform{% endblock %}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.js"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        body { 
            font-family: 'Inter', sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .pulse-green { animation: pulse-green 1s ease-in-out; }
        .pulse-red { animation: pulse-red 1s ease-in-out; }
        
        @keyframes pulse-green {
            0%, 100% { background-color: transparent; }
            50% { background-color: rgb(220, 252, 231); }
        }
        @keyframes pulse-red {
            0%, 100% { background-color: transparent; }
            50% { background-color: rgb(254, 226, 226); }
        }
        
        .pkr-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .pkr-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .pkr-logo {
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 50%, #6366f1 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 800;
            letter-spacing: -0.02em;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .signal-card {
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(5px);
        }
        
        .signal-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .stats-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(255, 255, 255, 0.9) 100%);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.4);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
        }
        
        .stats-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }
        
        .stats-card:hover::before {
            left: 100%;
        }
        
        .stats-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
        }
        
        .professional-table {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
        }
        
        .table-header {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-bottom: 2px solid rgba(99, 102, 241, 0.1);
        }
        
        .form-input {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(99, 102, 241, 0.1);
            transition: all 0.3s ease;
        }
        
        .form-input:focus {
            background: rgba(255, 255, 255, 0.95);
            border-color: rgba(99, 102, 241, 0.5);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
        }
        
        .tab-button {
            transition: all 0.3s ease;
            position: relative;
        }
        
        .tab-button:hover {
            transform: translateY(-1px);
        }
        
        .tab-button.active {
            background: linear-gradient(to bottom, rgba(59, 130, 246, 0.05), rgba(59, 130, 246, 0.1));
        }
        
        .tab-content {
            animation: fadeIn 0.3s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .tab-content.hidden {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body class="bg-gray-50">
    {% block content %}{% endblock %}
    
    <script>
        // Initialize Lucide icons
        lucide.createIcons();
        
        // Socket.IO connection
        const socket = io();
        
        socket.on('connect', function() {
            console.log('Connected to real-time updates');
        });
        
        socket.on('market_update', function(data) {
            updateMarketData(data);
        });
        
        function updateMarketData(data) {
            // Update Nifty price
            if (data.nifty_data) {
                const priceElement = document.getElementById('nifty-price');
                const changeElement = document.getElementById('nifty-change');
                
                if (priceElement) {
                    priceElement.textContent = data.nifty_data.price.toFixed(2);
                    priceElement.classList.add(data.nifty_data.change >= 0 ? 'pulse-green' : 'pulse-red');
                    setTimeout(() => {
                        priceElement.classList.remove('pulse-green', 'pulse-red');
                    }, 1000);
                }
                
                if (changeElement) {
                    const change = data.nifty_data.change;
                    const changePercent = data.nifty_data.change_percent;
                    changeElement.textContent = `${change >= 0 ? '+' : ''}${change.toFixed(2)} (${changePercent.toFixed(2)}%)`;
                    changeElement.className = `text-sm font-medium ${change >= 0 ? 'text-green-600' : 'text-red-600'}`;
                }
            }
            
            // Update signals
            if (data.new_signals && data.new_signals.length > 0) {
                addNewSignals(data.new_signals);
            }
            
            // Update options chain
            if (data.options_chain) {
                updateOptionsChain(data.options_chain);
            }
        }
        
        function addNewSignals(signals) {
            const signalsContainer = document.getElementById('signals-container');
            if (!signalsContainer) return;
            
            signals.forEach(signal => {
                const signalElement = createSignalElement(signal);
                signalsContainer.insertBefore(signalElement, signalsContainer.firstChild);
                
                // Remove old signals to keep only latest 5
                const allSignals = signalsContainer.children;
                if (allSignals.length > 5) {
                    signalsContainer.removeChild(allSignals[allSignals.length - 1]);
                }
            });
        }
        
        function createSignalElement(signal) {
            const div = document.createElement('div');
            div.className = `signal-card rounded-2xl p-5 border-l-4 ${
                signal.type === 'CALL' 
                    ? 'border-green-500 bg-gradient-to-r from-green-50 to-green-100' 
                    : 'border-red-500 bg-gradient-to-r from-red-50 to-red-100'
            }`;
            
            div.innerHTML = `
                <div class="flex items-center justify-between mb-3">
                    <div class="flex items-center space-x-3">
                        <span class="px-3 py-1 text-xs font-bold text-white rounded-full shadow-lg ${
                            signal.type === 'CALL' ? 'bg-gradient-to-r from-green-500 to-green-600' : 'bg-gradient-to-r from-red-500 to-red-600'
                        }">${signal.type}</span>
                        <span class="font-bold text-lg text-gray-800">${signal.strike_price} ${signal.type === 'CALL' ? 'CE' : 'PE'}</span>
                    </div>
                    <div class="text-right">
                        <span class="font-bold text-sm px-2 py-1 rounded-full ${
                            signal.confidence >= 90 ? 'text-green-700 bg-green-200' : 
                            signal.confidence >= 75 ? 'text-orange-700 bg-orange-200' : 'text-gray-700 bg-gray-200'
                        }">${signal.confidence}%</span>
                        <p class="text-xs text-gray-500 mt-1">Confidence</p>
                    </div>
                </div>
                <div class="bg-white/70 rounded-xl p-3 mb-3">
                    <p class="text-sm text-gray-700 font-medium">${signal.reasoning}</p>
                </div>
                <div class="flex items-center justify-between">
                    <div class="flex space-x-4 text-sm">
                        <span class="text-green-700 font-semibold">Target: ₹${signal.target_price}</span>
                        <span class="text-red-700 font-semibold">SL: ₹${signal.stop_loss}</span>
                    </div>
                    <span class="text-xs text-gray-500 bg-white/50 px-2 py-1 rounded-full">Just now</span>
                </div>
                <div class="mt-2 text-xs text-gray-600 text-center">
                    <span class="bg-white/60 px-2 py-1 rounded-full">NIFINOVA AI Signal</span>
                </div>
            `;
            
            return div;
        }
        
        function updateOptionsChain(optionsData) {
            const tbody = document.getElementById('options-tbody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            optionsData.forEach(option => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                row.innerHTML = `
                    <td class="px-4 py-3 text-green-600 font-medium">${option.call_ltp.toFixed(2)}</td>
                    <td class="px-4 py-3 text-gray-600">${option.call_volume.toLocaleString()}</td>
                    <td class="px-4 py-3 text-center font-bold bg-yellow-50">${option.strike_price}</td>
                    <td class="px-4 py-3 text-right text-gray-600">${option.put_volume.toLocaleString()}</td>
                    <td class="px-4 py-3 text-right text-red-600 font-medium">${option.put_ltp.toFixed(2)}</td>
                `;
                tbody.appendChild(row);
            });
        }
    </script>
</body>
</html>